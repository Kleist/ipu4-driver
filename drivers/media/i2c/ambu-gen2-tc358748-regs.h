/* SPDX-License-Identifier: GPL-2.0-only */
/*
 * Copyright (c) 2023 Ambu A/S.
 *
 */

#ifndef AMBU_GEN2_TC358748_REGS_H
#define AMBU_GEN2_TC358748_REGS_

#define IEIB475_MIPI_TC_I2C_ADDRESS	0x0E  // Toshiba MIPI Bridge

// #define CRL_REG_LEN_08BIT			1
#define CRL_REG_LEN_16BIT			2
// #define CRL_REG_LEN_24BIT			3
#define CRL_REG_LEN_32BIT			4

// #define CRL_REG_READ_AND_UPDATE			(1 << 3)
// #define CRL_REG_LEN_READ_MASK			0x07
#define CRL_REG_LEN_DELAY			0x10

struct crl_register_write_rep {
	u16 address;
	u8 len;
	u32 val;
	u16 dev_i2c_addr;
	u32 mask;
};

static const struct crl_register_write_rep ieib475_source_RGB_800_800[] = {
  // Stream-off
	// Set FrmStop to 1’b1 (Clear RstPtr to 1’b0)
	{ 0x0032, CRL_REG_LEN_16BIT, 0x8000, IEIB475_MIPI_TC_I2C_ADDRESS},
	{ 0x0000, CRL_REG_LEN_DELAY, 100}, // delay min 1 frame
	// Clear PP_En to 1’b0
	{ 0x0004, CRL_REG_LEN_16BIT, 0x8004, IEIB475_MIPI_TC_I2C_ADDRESS},
	// Set RstPtr to 1’b1 - (Clear FrmStop to 1’b0)
	{ 0x0032, CRL_REG_LEN_16BIT, 0x4000, IEIB475_MIPI_TC_I2C_ADDRESS},
	{ 0x0000, CRL_REG_LEN_DELAY, 30},  //delay, might not be needed

  //Reset color bar
	{ 0x00e0, CRL_REG_LEN_16BIT, 0x0000, IEIB475_MIPI_TC_I2C_ADDRESS },
  //Software Reset
	{ 0x0002, CRL_REG_LEN_16BIT, 0x0001, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0000, CRL_REG_LEN_DELAY, 0xA},  //delay 10 ms
	{ 0x0002, CRL_REG_LEN_16BIT, 0x0000, IEIB475_MIPI_TC_I2C_ADDRESS },
  //PLL,Clock Setting
	{ 0x0016, CRL_REG_LEN_16BIT, 0x2063, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0018, CRL_REG_LEN_16BIT, 0x0203, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0000, CRL_REG_LEN_DELAY, 0x1},  //delay 1 ms
	{ 0x0018, CRL_REG_LEN_16BIT, 0x0213, IEIB475_MIPI_TC_I2C_ADDRESS },
  //DPI Input Control
	{ 0x0006, CRL_REG_LEN_16BIT, 0x00FA, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0008, CRL_REG_LEN_16BIT, 0x0030, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0022, CRL_REG_LEN_16BIT, 0x0960, IEIB475_MIPI_TC_I2C_ADDRESS },
  //D-PHY Setting
	{ 0x0140, CRL_REG_LEN_32BIT, 0x00000000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0144, CRL_REG_LEN_32BIT, 0x00000000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0148, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x014C, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0150, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
  //CSI2-TX PPI Control
	{ 0x0210, CRL_REG_LEN_32BIT, 0x1F400000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0214, CRL_REG_LEN_32BIT, 0x00060000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0218, CRL_REG_LEN_32BIT, 0x23030000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0220, CRL_REG_LEN_32BIT, 0x64050000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0224, CRL_REG_LEN_32BIT, 0x4E200000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x022C, CRL_REG_LEN_32BIT, 0x00030000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0230, CRL_REG_LEN_32BIT, 0x00050000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0234, CRL_REG_LEN_32BIT, 0x00030000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0238, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0204, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0518, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
  //Set to HS mode
	{ 0x0500, CRL_REG_LEN_32BIT, 0x8081A300, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0020, CRL_REG_LEN_16BIT, 0x0028, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x000C, CRL_REG_LEN_16BIT, 0x0404, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0004, CRL_REG_LEN_16BIT, 0x8044, IEIB475_MIPI_TC_I2C_ADDRESS },
};

static const struct crl_register_write_rep ieib475_source_RGB_400_400[] = {
  // Stream-off - workaround to return from pattern mode
	// Set FrmStop to 1’b1 (Clear RstPtr to 1’b0)
	{ 0x0032, CRL_REG_LEN_16BIT, 0x8000, IEIB475_MIPI_TC_I2C_ADDRESS},
	{ 0x0000, CRL_REG_LEN_DELAY, 100}, // delay min 1 frame

	// Clear PP_En to 1’b0
	{ 0x0004, CRL_REG_LEN_16BIT, 0x8004, IEIB475_MIPI_TC_I2C_ADDRESS},

	// Set RstPtr to 1’b1 - (Clear FrmStop to 1’b0)
	{ 0x0032, CRL_REG_LEN_16BIT, 0x4000, IEIB475_MIPI_TC_I2C_ADDRESS},
	{ 0x0000, CRL_REG_LEN_DELAY, 30},  //delay, might not be needed

  //Reset color bar
	{ 0x00e0, CRL_REG_LEN_16BIT, 0x0000, IEIB475_MIPI_TC_I2C_ADDRESS },
  //Software Reset
	{ 0x0002, CRL_REG_LEN_16BIT, 0x0001, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0000, CRL_REG_LEN_DELAY, 0x0A},  //delay 10 ms
	{ 0x0002, CRL_REG_LEN_16BIT, 0x0000, IEIB475_MIPI_TC_I2C_ADDRESS },
  //PLL,Clock Setting
	{ 0x0016, CRL_REG_LEN_16BIT, 0x2054, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0018, CRL_REG_LEN_16BIT, 0x0603, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0000, CRL_REG_LEN_DELAY, 0x1},  //delay 1 ms
	{ 0x0018, CRL_REG_LEN_16BIT, 0x0613, IEIB475_MIPI_TC_I2C_ADDRESS },
  //DPI Input Control
	{ 0x0006, CRL_REG_LEN_16BIT, 0x01F4, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0008, CRL_REG_LEN_16BIT, 0x0030, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0022, CRL_REG_LEN_16BIT, 0x04B0, IEIB475_MIPI_TC_I2C_ADDRESS },
  //D-PHY Setting
	{ 0x0140, CRL_REG_LEN_32BIT, 0x00000000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0144, CRL_REG_LEN_32BIT, 0x00000000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0148, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x014C, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0150, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
  //CSI2-TX PPI Control
	{ 0x0210, CRL_REG_LEN_32BIT, 0x0FA00000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0214, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0218, CRL_REG_LEN_32BIT, 0x0A010000, IEIB475_MIPI_TC_I2C_ADDRESS },
	//{ 0x021C, CRL_REG_LEN_32BIT, 0x00020000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0220, CRL_REG_LEN_32BIT, 0x00020000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0224, CRL_REG_LEN_32BIT, 0x4E200000, IEIB475_MIPI_TC_I2C_ADDRESS },
	//{ 0x0228, CRL_REG_LEN_32BIT, 0x00080000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x022C, CRL_REG_LEN_32BIT, 0x00000000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0230, CRL_REG_LEN_32BIT, 0x00050000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0234, CRL_REG_LEN_32BIT, 0x00030000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0238, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0204, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0518, CRL_REG_LEN_32BIT, 0x00010000, IEIB475_MIPI_TC_I2C_ADDRESS },
  //Set to HS mode
	{ 0x0500, CRL_REG_LEN_32BIT, 0x8081A300, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0020, CRL_REG_LEN_16BIT, 0x0028, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x000C, CRL_REG_LEN_16BIT, 0x0404, IEIB475_MIPI_TC_I2C_ADDRESS },
	{ 0x0004, CRL_REG_LEN_16BIT, 0x8044, IEIB475_MIPI_TC_I2C_ADDRESS },
};


// Frame Stop - When this bit is asserted, TC358746A will stop outputting at the next Vvalid
// Reset Pointers - When this bit is asserted, TC358746A resets its write/read pointers to Video Buffer
static const struct crl_register_write_rep ieib475_streamoff_regs[] = {
	// Shutdown
	{ 0x0032, CRL_REG_LEN_16BIT, 0x8000, IEIB475_MIPI_TC_I2C_ADDRESS}, // Set FrmStop to 1’b1 (Clear RstPtr to 1’b0)
	{ 0x0000, CRL_REG_LEN_DELAY, 100}, // delay min 1 frame
	{ 0x0004, CRL_REG_LEN_16BIT, 0x8004, IEIB475_MIPI_TC_I2C_ADDRESS}, // Clear PP_En to 1’b0
	{ 0x0032, CRL_REG_LEN_16BIT, 0x4000, IEIB475_MIPI_TC_I2C_ADDRESS}, // Set RstPtr to 1’b1 - (Clear FrmStop to 1’b0)
};

#endif /* AMBU_GEN2_TC358748_REGS_ */
